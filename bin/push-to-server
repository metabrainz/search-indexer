#!/bin/sh
set -e

HOST="$1"
COMMAND="$2"
SSH="ssh -i $HOME/.ssh/push-to-server_id -o IdentitiesOnly=yes"

case "$2" in
	sync)
		echo "delete old indexes"
                $SSH $HOST prepare 

		echo "start nc on target"
                $SSH $HOST sync &

		echo "sleeping 30 seconds"
		sleep 30
		cd /home/search/data/cur

		echo "start copy!"
                tar cvO . | nc $HOST 7000
		cd -
		;;
	rotate)
		$SSH $HOST rotate
		;;
	restart)
		$SSH $HOST restart
		;;
	*)
		echo "Unknown action in $0" >&2
		exit 1
		;;
esac

# eof
